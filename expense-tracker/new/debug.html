<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker - Debug Version</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/theme.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <i class="fas fa-wallet"></i>
                <h1>Expense Tracker Debug</h1>
            </div>
            <button id="theme-toggle" class="btn-icon">
                <i class="fas fa-moon"></i>
            </button>
        </header>
        
        <main style="text-align: center; padding: 40px;">
            <h2>Debug Console</h2>
            <div id="debug-console" style="
                background: #1e1e1e;
                color: #00ff00;
                padding: 20px;
                border-radius: 10px;
                text-align: left;
                font-family: monospace;
                height: 300px;
                overflow-y: auto;
                margin: 20px 0;
                white-space: pre-wrap;
            "></div>
            
            <div style="margin: 20px;">
                <button onclick="runTests()" class="btn btn-primary">
                    <i class="fas fa-vial"></i> Run Tests
                </button>
                <button onclick="clearConsole()" class="btn btn-secondary">
                    <i class="fas fa-eraser"></i> Clear Console
                </button>
            </div>
            
            <div id="test-results" style="margin-top: 30px;"></div>
        </main>
    </div>

    <script>
        const consoleDiv = document.getElementById('debug-console');
        
        // Override console.log to display in our div
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function logToDiv(type, args) {
            const message = Array.from(args).map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const entry = document.createElement('div');
            entry.style.cssText = `
                margin: 2px 0;
                padding: 4px;
                border-left: 3px solid ${type === 'error' ? '#ff4444' : type === 'warn' ? '#ffaa00' : '#4444ff'};
                background: rgba(255,255,255,0.05);
            `;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleDiv.appendChild(entry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            // Also log to original console
            if (type === 'log') originalLog.apply(console, args);
            if (type === 'error') originalError.apply(console, args);
            if (type === 'warn') originalWarn.apply(console, args);
        }
        
        console.log = function(...args) { logToDiv('log', args); };
        console.error = function(...args) { logToDiv('error', args); };
        console.warn = function(...args) { logToDiv('warn', args); };
        
        function clearConsole() {
            consoleDiv.innerHTML = '';
            console.log('Console cleared');
        }
        
        function runTests() {
            console.log('=== Starting Tests ===');
            
            // Test 1: Check localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                console.log('✅ Test 1: localStorage is working');
            } catch (e) {
                console.error('❌ Test 1: localStorage error:', e.message);
            }
            
            // Test 2: Check theme
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme') || 'light';
            console.log(`✅ Test 2: Current theme is "${currentTheme}"`);
            
            // Test 3: Test CSS loading
            const computedStyle = window.getComputedStyle(document.body);
            const bgColor = computedStyle.backgroundColor;
            console.log(`✅ Test 3: Body background color: ${bgColor}`);
            
            // Test 4: Check Font Awesome
            const faIcons = document.querySelectorAll('.fas, .fab, .far');
            console.log(`✅ Test 4: Found ${faIcons.length} Font Awesome icons`);
            
            console.log('=== Tests Complete ===');
            
            // Show results
            const results = document.getElementById('test-results');
            results.innerHTML = `
                <div class="card" style="text-align: left;">
                    <h3><i class="fas fa-clipboard-check"></i> Test Results</h3>
                    <p>Check the debug console above for detailed results.</p>
                    <p>If all tests pass, the main app should work.</p>
                    <button onclick="window.location.href='index.html'" class="btn btn-primary" style="margin-top: 20px;">
                        <i class="fas fa-arrow-right"></i> Go to Main App
                    </button>
                </div>
            `;
        }
        
        // Initialize theme toggle
        document.getElementById('theme-toggle').addEventListener('click', function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            
            const icon = this.querySelector('i');
            icon.className = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            
            localStorage.setItem('expense-tracker-theme', newTheme);
            console.log(`Theme changed to: ${newTheme}`);
        });
        
        // Load saved theme
        window.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('expense-tracker-theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const icon = document.querySelector('#theme-toggle i');
            if (icon) {
                icon.className = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            }
            
            console.log('Debug page loaded');
            console.log('Initial theme:', savedTheme);
            console.log('Ready to run tests...');
        });
    </script>
</body>
</html>
