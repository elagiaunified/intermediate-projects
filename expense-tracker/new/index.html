<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker | Multi-Currency Manager</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="icon" type="image/x-icon" href="assets/icons/wallet.svg">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-wallet"></i>
                <h1>Expense Tracker</h1>
            </div>
            <div class="header-controls">
                <div class="currency-selector">
                    <label for="base-currency">Base Currency:</label>
                    <select id="base-currency">
                        <option value="USD">USD ($)</option>
                        <option value="EUR">EUR (‚Ç¨)</option>
                        <option value="GBP">GBP (¬£)</option>
                        <option value="JPY">JPY (¬•)</option>
                        <option value="CAD">CAD (C$)</option>
                        <option value="AUD">AUD (A$)</option>
                        <option value="INR">INR (‚Çπ)</option>
                    </select>
                </div>
                <button id="theme-toggle" class="btn-icon" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <!-- Dashboard -->
        <section class="dashboard">
            <div class="stats-card total-balance">
                <h3><i class="fas fa-money-bill-wave"></i> Total Balance</h3>
                <p id="total-balance" class="amount">$0.00</p>
                <small>In base currency</small>
            </div>
            <div class="stats-card monthly-expense">
                <h3><i class="fas fa-calendar-alt"></i> This Month</h3>
                <p id="monthly-expense" class="amount">$0.00</p>
                <small>Total expenses</small>
            </div>
            <div class="stats-card category-count">
                <h3><i class="fas fa-tags"></i> Categories</h3>
                <p id="category-count" class="amount">0</p>
                <small>Active</small>
            </div>
            <div class="stats-card currency-count">
                <h3><i class="fas fa-globe"></i> Currencies</h3>
                <p id="currency-count" class="amount">1</p>
                <small>In use</small>
            </div>
        </section>

        <main class="main-content">
            <!-- Left Column: Add Expense & Chart -->
            <div class="left-column">
                <!-- Add Expense Form -->
                <section class="card add-expense-form">
                    <h2><i class="fas fa-plus-circle"></i> Add New Expense</h2>
                    <form id="expense-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-name">Description *</label>
                                <input type="text" id="expense-name" placeholder="e.g., Groceries, Dinner, Uber" required>
                            </div>
                            <div class="form-group">
                                <label for="expense-amount">Amount *</label>
                                <input type="number" id="expense-amount" min="0.01" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-currency">Currency</label>
                                <select id="expense-currency">
                                    <option value="USD">USD ($)</option>
                                    <option value="EUR">EUR (‚Ç¨)</option>
                                    <option value="GBP">GBP (¬£)</option>
                                    <option value="JPY">JPY (¬•)</option>
                                    <option value="CAD">CAD (C$)</option>
                                    <option value="AUD">AUD (A$)</option>
                                    <option value="INR">INR (‚Çπ)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="expense-category">Category</label>
                                <select id="expense-category">
                                    <option value="food">üçï Food & Dining</option>
                                    <option value="transport">üöó Transportation</option>
                                    <option value="shopping">üõçÔ∏è Shopping</option>
                                    <option value="entertainment">üé¨ Entertainment</option>
                                    <option value="bills">üí° Bills & Utilities</option>
                                    <option value="health">üè• Health & Medical</option>
                                    <option value="education">üìö Education</option>
                                    <option value="other">üì¶ Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expense-date">Date</label>
                                <input type="date" id="expense-date">
                            </div>
                            <div class="form-group">
                                <label for="expense-payment">Payment Method</label>
                                <select id="expense-payment">
                                    <option value="cash">üíµ Cash</option>
                                    <option value="credit">üí≥ Credit Card</option>
                                    <option value="debit">üè¶ Debit Card</option>
                                    <option value="digital">üì± Digital Wallet</option>
                                    <option value="other">üîÑ Other</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="expense-notes">Notes (Optional)</label>
                            <textarea id="expense-notes" placeholder="Additional details about this expense..." rows="2"></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Add Expense
                            </button>
                            <button type="button" id="clear-form" class="btn btn-secondary">
                                <i class="fas fa-eraser"></i> Clear
                            </button>
                        </div>
                    </form>
                </section>

                <!-- Charts Section -->
                <section class="card charts-section">
                    <h2><i class="fas fa-chart-pie"></i> Spending Analysis</h2>
                    <div class="chart-container">
                        <canvas id="category-chart"></canvas>
                    </div>
                    <div class="chart-controls">
                        <button id="view-monthly" class="btn btn-small active">Monthly</button>
                        <button id="view-yearly" class="btn btn-small">Yearly</button>
                        <button id="export-chart" class="btn btn-small">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </section>
            </div>

            <!-- Right Column: Expense List & Filters -->
            <div class="right-column">
                <!-- Expense List -->
                <section class="card expense-list-section">
                    <div class="section-header">
                        <h2><i class="fas fa-receipt"></i> Recent Expenses</h2>
                        <div class="list-controls">
                            <button id="export-data" class="btn btn-small">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                            <button id="import-data" class="btn btn-small">
                                <i class="fas fa-file-import"></i> Import
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filters -->
                    <div class="filters">
                        <div class="filter-group">
                            <input type="text" id="search-expenses" placeholder="Search expenses...">
                        </div>
                        <div class="filter-group">
                            <select id="filter-category">
                                <option value="">All Categories</option>
                                <option value="food">Food & Dining</option>
                                <option value="transport">Transportation</option>
                                <option value="shopping">Shopping</option>
                                <option value="entertainment">Entertainment</option>
                                <option value="bills">Bills & Utilities</option>
                                <option value="health">Health & Medical</option>
                                <option value="education">Education</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <select id="filter-currency">
                                <option value="">All Currencies</option>
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                                <option value="JPY">JPY</option>
                                <option value="CAD">CAD</option>
                                <option value="AUD">AUD</option>
                                <option value="INR">INR</option>
                            </select>
                        </div>
                        <button id="clear-filters" class="btn btn-small">
                            <i class="fas fa-filter"></i> Clear Filters
                        </button>
                    </div>
                    
                    <!-- Expense List Table -->
                    <div class="table-container">
                        <table id="expense-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>In Base</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="expense-table-body">
                                <!-- Expenses will be loaded here dynamically -->
                                <tr class="empty-row">
                                    <td colspan="6">No expenses added yet. Start by adding your first expense!</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Table Summary -->
                    <div class="table-summary">
                        <div class="summary-item">
                            <span>Showing</span>
                            <strong id="showing-count">0</strong>
                            <span>of</span>
                            <strong id="total-count">0</strong>
                            <span>expenses</span>
                        </div>
                        <div class="summary-item">
                            <span>Filtered Total:</span>
                            <strong id="filtered-total">$0.00</strong>
                        </div>
                    </div>
                </section>

                <!-- Currency Rates -->
                <section class="card currency-rates">
                    <h2><i class="fas fa-exchange-alt"></i> Currency Rates</h2>
                    <div class="rates-info">
                        <p>Base: <strong id="current-base">USD</strong></p>
                        <p>Last updated: <span id="rates-updated">Never</span></p>
                        <button id="refresh-rates" class="btn btn-small">
                            <i class="fas fa-sync-alt"></i> Refresh Rates
                        </button>
                    </div>
                    <div class="rates-grid" id="rates-grid">
                        <!-- Currency rates will be loaded here -->
                        <div class="rate-item loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading exchange rates...
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Hidden file input for import -->
        <input type="file" id="import-file" accept=".json,.csv" style="display: none;">

        <!-- Footer -->
        <footer class="footer">
            <p>Expense Tracker with Multi-Currency Support &copy; <span id="current-year">2024</span></p>
            <p>Currency rates provided by <a href="https://www.exchangerate-api.com" target="_blank">ExchangeRate-API</a></p>
            <div class="footer-links">
                <a href="#" id="clear-all-data"><i class="fas fa-trash-alt"></i> Clear All Data</a>
                <a href="#" id="backup-data"><i class="fas fa-download"></i> Backup Data</a>
                <a href="#" id="restore-data"><i class="fas fa-upload"></i> Restore Data</a>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
        <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/storageManager.js"></script>
    <script src="js/currencyConverter.js"></script>
    <script src="js/expenseManager.js"></script>
    <script src="js/chartManager.js"></script>
    <script src="js/main.js"></script>
 <!-- Load our scripts with error handling -->
    <script>
        // Load JavaScript files with error handling
        function loadScript(src, onSuccess, onError) {
            const script = document.createElement('script');
            script.src = src;
            script.onload = onSuccess;
            script.onerror = onError || function() {
                console.error('Failed to load script:', src);
            };
            document.head.appendChild(script);
        }
        
        // Load scripts in correct order
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting script loading...');
            
            // Load scripts sequentially
            const scripts = [
                'js/storageManager.js',
                'js/currencyConverter.js',
                'js/expenseManager.js',
                'js/chartManager.js',
                'js/main.js'
            ];
            
            let currentIndex = 0;
            
            function loadNextScript() {
                if (currentIndex >= scripts.length) {
                    console.log('All scripts loaded, initializing app...');
                    // Initialize the app
                    if (typeof ExpenseTrackerApp !== 'undefined') {
                        window.app = new ExpenseTrackerApp();
                        console.log('App initialized successfully!');
                    } else {
                        console.error('ExpenseTrackerApp not defined!');
                    }
                    return;
                }
                
                const script = scripts[currentIndex];
                console.log('Loading:', script);
                
                loadScript(script, function() {
                    console.log('Successfully loaded:', script);
                    currentIndex++;
                    loadNextScript();
                }, function() {
                    console.error('Failed to load:', script);
                    currentIndex++;
                    loadNextScript(); // Continue anyway
                });
            }
            
            loadNextScript();
        });
    </script>

</body>
</html>
