<!DOCTYPE html>
<html>
<head>
    <title>Test Scope Fix</title>
</head>
<body>
    <h1>Testing Class Scope</h1>
    <div id="output" style="padding: 20px; background: #f5f5f5; margin: 20px; font-family: monospace;"></div>
    
    <script>
        console.log('=== SCOPE TEST START ===');
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.style.cssText = `margin: 5px 0; padding: 5px; color: ${type === 'error' ? 'red' : type === 'success' ? 'green' : 'black'}`;
            div.textContent = message;
            output.appendChild(div);
            console.log(message);
        }
        
        // Define ALL classes in GLOBAL scope (not inside try-catch)
        log('Defining all classes in GLOBAL scope...');
        
        // ===== GLOBAL CLASS DEFINITIONS =====
        
        // 1. StorageManager
        class StorageManager {
            constructor() {
                log('StorageManager constructor called', 'info');
                this.storageKey = 'expense-tracker-data';
            }
            saveExpenses(expenses) {
                localStorage.setItem(this.storageKey, JSON.stringify(expenses));
            }
            loadExpenses() {
                const data = localStorage.getItem(this.storageKey);
                return data ? JSON.parse(data) : [];
            }
        }
        log('‚úÖ StorageManager defined globally', 'success');
        
        // 2. ExpenseManager
        class ExpenseManager {
            constructor() {
                log('ExpenseManager constructor called', 'info');
                this.expenses = [];
                this.nextId = 1;
            }
            addExpense(data) {
                const expense = {
                    id: this.nextId++,
                    ...data,
                    createdAt: new Date().toISOString()
                };
                this.expenses.push(expense);
                return expense;
            }
            getExpenses() {
                return [...this.expenses];
            }
        }
        log('‚úÖ ExpenseManager defined globally', 'success');
        
        // 3. CurrencyConverter
        class CurrencyConverter {
            constructor() {
                log('CurrencyConverter constructor called', 'info');
                this.fallbackRates = {
                    USD: { USD: 1, EUR: 0.92, GBP: 0.79 }
                };
            }
            getExchangeRates(base = 'USD') {
                return this.fallbackRates[base] || this.fallbackRates.USD;
            }
        }
        log('‚úÖ CurrencyConverter defined globally', 'success');
        
        // 4. ChartManager
        class ChartManager {
            constructor() {
                log('ChartManager constructor called', 'info');
            }
            init() {
                log('ChartManager.init() called', 'info');
            }
        }
        log('‚úÖ ChartManager defined globally', 'success');
        
        // 5. ExpenseTrackerApp
        class ExpenseTrackerApp {
            constructor() {
                log('ExpenseTrackerApp constructor called', 'info');
                
                // Check if dependencies exist
                log('Checking dependencies...', 'info');
                
                if (typeof ExpenseManager === 'undefined') {
                    throw new Error('ExpenseManager is not defined');
                }
                if (typeof CurrencyConverter === 'undefined') {
                    throw new Error('CurrencyConverter is not defined');
                }
                if (typeof ChartManager === 'undefined') {
                    throw new Error('ChartManager is not defined');
                }
                if (typeof StorageManager === 'undefined') {
                    throw new Error('StorageManager is not defined');
                }
                
                // Create instances
                this.expenseManager = new ExpenseManager();
                this.currencyConverter = new CurrencyConverter();
                this.chartManager = new ChartManager();
                this.storageManager = new StorageManager();
                
                log('All managers created successfully', 'success');
                
                this.currentBaseCurrency = 'USD';
                this.init();
            }
            
            init() {
                log('ExpenseTrackerApp.init() called', 'success');
                log('üéâ APP IS WORKING!', 'success');
            }
        }
        log('‚úÖ ExpenseTrackerApp defined globally', 'success');
        
        // ===== TEST CREATING INSTANCES =====
        log('\n=== TESTING INSTANCE CREATION ===');
        
        try {
            log('Creating StorageManager instance...', 'info');
            const storage = new StorageManager();
            log('‚úÖ StorageManager instance created', 'success');
            
            log('Creating ExpenseManager instance...', 'info');
            const expenses = new ExpenseManager();
            log('‚úÖ ExpenseManager instance created', 'success');
            
            log('Creating CurrencyConverter instance...', 'info');
            const converter = new CurrencyConverter();
            log('‚úÖ CurrencyConverter instance created', 'success');
            
            log('Creating ChartManager instance...', 'info');
            const charts = new ChartManager();
            log('‚úÖ ChartManager instance created', 'success');
            
            log('Creating ExpenseTrackerApp instance...', 'info');
            const app = new ExpenseTrackerApp();
            log('‚úÖ ExpenseTrackerApp instance created', 'success');
            log('üéâ ALL TESTS PASSED!', 'success');
            
        } catch (error) {
            log(`‚ùå Error creating instance: ${error.message}`, 'error');
            log(`Stack: ${error.stack}`, 'error');
        }
        
        log('\n=== CHECKING GLOBAL SCOPE ===');
        log(`window.StorageManager: ${typeof window.StorageManager}`, 'info');
        log(`window.ExpenseManager: ${typeof window.ExpenseManager}`, 'info');
        log(`window.CurrencyConverter: ${typeof window.CurrencyConverter}`, 'info');
        log(`window.ChartManager: ${typeof window.ChartManager}`, 'info');
        log(`window.ExpenseTrackerApp: ${typeof window.ExpenseTrackerApp}`, 'info');
        
        console.log('=== SCOPE TEST END ===');
    </script>
</body>
</html>
